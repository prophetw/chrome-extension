# 视频下载助手 Chrome 扩展

一个功能强大的 Chrome 扩展，可以检测和下载网页中的各种类型视频，包括 HLS 流媒体视频（m3u8）、MP4、WebM、FLV 等格式。

## 功能特性

- ✅ **多格式支持**: 支持 MP4、WebM、FLV、HLS(m3u8)、TS 等多种视频格式
- ✅ **智能检测**: 自动检测页面中的视频元素和网络请求
- ✅ **实时监控**: 监控 XMLHttpRequest、Fetch API、WebSocket 等网络活动
- ✅ **流媒体支持**: 支持 HLS.js、Video.js 等流媒体播放器
- ✅ **批量管理**: 可同时检测多个视频，批量下载
- ✅ **用户友好**: 清晰的界面，显示视频信息和下载状态

## 安装方法

### 方法一：开发者模式安装（推荐）

1. 打开 Chrome 浏览器
2. 在地址栏输入 `chrome://extensions/`
3. 开启右上角的"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择 `fetchVideo` 文件夹
6. 扩展安装完成

### 方法二：打包安装

```bash
# 打包扩展
cd fetchVideo
zip -r video-downloader.zip . -x "*.git*" "*.DS_Store*"
```

然后在 Chrome 扩展管理页面拖拽 zip 文件进行安装。

## 使用方法

### 基本使用

1. **安装扩展后**，Chrome 工具栏会出现视频下载助手图标
2. **访问包含视频的网页**，扩展会自动检测视频
3. **点击扩展图标**，查看检测到的视频列表
4. **选择要下载的视频**，点击"下载"按钮

### 功能说明

#### 自动检测
- 扩展会自动检测页面中的 `<video>` 元素
- 监控网络请求，捕获视频文件 URL
- 支持动态加载的视频内容

#### 视频信息
每个检测到的视频会显示：
- 视频标题
- 视频格式/类型
- 视频时长（如果可获取）
- 视频尺寸（如果可获取）
- 视频 URL

#### 操作选项
- **📥 下载**: 直接下载视频文件
- **📋 复制**: 复制视频链接到剪贴板
- **🔗 打开**: 在新标签页中打开视频链接

#### 控制选项
- **🔄 刷新检测**: 重新扫描页面中的视频
- **🗑️ 清空列表**: 清除当前检测到的视频列表

## 支持的网站类型

### 视频播放网站
- YouTube（部分）
- Bilibili
- 优酷、爱奇艺等视频网站
- 直播平台
- 在线教育平台

### 视频格式
- **MP4**: 最常见的视频格式
- **WebM**: Google 开发的开放格式
- **FLV**: Flash 视频格式
- **HLS (m3u8)**: HTTP Live Streaming
- **DASH**: Dynamic Adaptive Streaming
- **TS**: Transport Stream 片段

## 技术实现

### 架构设计
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Background    │    │   Content       │    │   Inject        │
│   Script        │◄──►│   Script        │◄──►│   Script        │
│                 │    │                 │    │                 │
│ - 消息处理      │    │ - DOM 监控      │    │ - 深度拦截      │
│ - 下载管理      │    │ - 元素检测      │    │ - 网络监听      │
│ - 数据存储      │    │ - 事件转发      │    │ - 库拦截        │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         ▲                                                ▲
         │                                                │
         ▼                                                ▼
┌─────────────────┐                            ┌─────────────────┐
│     Popup       │                            │   Web Page      │
│     Interface   │                            │   Context       │
│                 │                            │                 │
│ - 视频列表      │                            │ - 播放器监控    │
│ - 下载控制      │                            │ - 网络请求      │
│ - 用户交互      │                            │ - 媒体 API      │
└─────────────────┘                            └─────────────────┘
```

### 检测机制

1. **DOM 元素检测**
   - 监控 `<video>` 标签
   - 检测 `<source>` 子元素
   - 使用 MutationObserver 监听动态变化

2. **网络请求拦截**
   - XMLHttpRequest 拦截
   - Fetch API 拦截
   - WebSocket 连接监控

3. **播放器库支持**
   - HLS.js 库拦截
   - Video.js 播放器监控
   - Media Source Extensions API

4. **页面上下文分析**
   - 扫描页面变量
   - 分析 JavaScript 对象
   - 检测流媒体配置

## 权限说明

扩展需要以下权限：

- `activeTab`: 访问当前活动标签页
- `storage`: 存储检测到的视频信息
- `downloads`: 触发文件下载
- `webRequest`: 监控网络请求
- `<all_urls>`: 在所有网站上工作

## 常见问题

### Q: 为什么某些视频无法下载？
A: 可能的原因：
- 视频受 DRM 保护
- 需要登录或付费
- 使用了特殊的流媒体技术
- 视频 URL 有时效性

### Q: 检测不到视频怎么办？
A: 尝试以下方法：
- 点击"刷新检测"按钮
- 播放视频后再检测
- 等待页面完全加载
- 检查是否被网站的反爬虫机制阻止

### Q: 下载的文件无法播放？
A: 可能的原因：
- 下载的是视频片段而非完整文件
- 需要使用专门的播放器
- 文件格式不被本地播放器支持

### Q: 如何下载 HLS (m3u8) 视频？
A: 
- 扩展可以检测 m3u8 文件
- 下载的是播放列表文件
- 需要使用支持 HLS 的工具下载完整视频

## 开发说明

### 文件结构
```
fetchVideo/
├── manifest.json          # 扩展配置文件
├── background.js          # 后台脚本
├── content.js            # 内容脚本
├── inject.js             # 注入脚本
├── popup.html            # 弹窗界面
├── popup.js              # 弹窗脚本
├── icons/                # 图标文件
│   ├── icon.svg
│   ├── icon16.png
│   ├── icon48.png
│   └── icon128.png
├── generate_icons.sh     # 图标生成脚本
└── README.md            # 说明文档
```

### 本地开发

1. 克隆或下载源代码
2. 在 Chrome 中加载扩展
3. 修改代码后重新加载扩展
4. 在控制台查看调试信息

### 贡献代码

欢迎提交 Issue 和 Pull Request！

## 许可证

MIT License

## 更新日志

### v1.0 (2025-08-31)
- ✅ 初始版本发布
- ✅ 支持多种视频格式检测
- ✅ 实现基本下载功能
- ✅ 添加用户界面
- ✅ 支持流媒体检测

## 免责声明

本扩展仅用于技术学习和合法的视频下载。请遵守相关网站的服务条款和版权法律，不要下载受版权保护的内容。开发者对用户的使用行为不承担任何责任。