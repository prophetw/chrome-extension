<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>M3U8 ä¸‹è½½æµ‹è¯• - FetchVideo</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 40px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    h1 {
      color: #1a73e8;
      text-align: center;
      margin-bottom: 30px;
    }
    
    .test-section {
      margin-bottom: 30px;
      padding: 20px;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      background: #fafafa;
    }
    
    .test-section h2 {
      color: #333;
      margin-bottom: 15px;
      border-bottom: 2px solid #1a73e8;
      padding-bottom: 5px;
    }
    
    .video-url {
      background: #f8f9fa;
      padding: 10px;
      border-radius: 4px;
      border-left: 4px solid #34a853;
      margin: 10px 0;
      font-family: monospace;
      word-break: break-all;
    }
    
    .test-button {
      background: #1a73e8;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
      font-size: 14px;
    }
    
    .test-button:hover {
      background: #1557b0;
    }
    
    .instructions {
      background: #e8f5e8;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 20px;
      border-left: 4px solid #34a853;
    }
    
    .warning {
      background: #fff3e0;
      padding: 15px;
      border-radius: 6px;
      margin: 15px 0;
      border-left: 4px solid #ff9800;
    }
    
    .code {
      background: #f8f9fa;
      padding: 10px;
      border-radius: 4px;
      border: 1px solid #e0e0e0;
      font-family: monospace;
      margin: 10px 0;
    }
    
    .status {
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
      display: none;
    }
    
    .status.success {
      background: #e6f4ea;
      color: #137333;
      border: 1px solid #34a853;
    }
    
    .status.error {
      background: #fce8e6;
      color: #d93025;
      border: 1px solid #ea4335;
    }
    
    .status.info {
      background: #e8f0fe;
      color: #1565c0;
      border: 1px solid #1a73e8;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ¬ M3U8 ä¸‹è½½åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="instructions">
      <h3>ğŸ“‹ ä½¿ç”¨è¯´æ˜</h3>
      <ol>
        <li>ç¡®ä¿å·²å®‰è£…å¹¶å¯ç”¨ FetchVideo æ‰©å±•</li>
        <li>ç‚¹å‡»ä¸‹é¢çš„æµ‹è¯•é“¾æ¥</li>
        <li>æ‰©å±•ä¼šè‡ªåŠ¨æ£€æµ‹é¡µé¢ä¸­çš„ M3U8 æµåª’ä½“</li>
        <li>åœ¨æ‰©å±•å¼¹çª—ä¸­ç‚¹å‡»ä¸‹è½½æŒ‰é’®</li>
        <li>è§‚å¯Ÿä¸‹è½½è¿›åº¦å’ŒçŠ¶æ€</li>
      </ol>
    </div>
    
    <div class="test-section">
      <h2>ğŸ”— æµ‹è¯• M3U8 é“¾æ¥</h2>
      <p>ä»¥ä¸‹æ˜¯ä¸€äº›ç”¨äºæµ‹è¯•çš„ M3U8 é“¾æ¥ï¼Œç‚¹å‡»å°†åœ¨é¡µé¢ä¸­æ¨¡æ‹Ÿæµåª’ä½“æ’­æ”¾ï¼š</p>
      
      <!-- ç¤ºä¾‹ M3U8 é“¾æ¥ 1 -->
      <div class="video-url" id="test-url-1">
        https://demo.unified-streaming.com/k8s/features/stable/video/tears-of-steel/tears-of-steel.ism/.m3u8
      </div>
      <button class="test-button" onclick="testM3u8Url('test-url-1')">æµ‹è¯•æ­¤é“¾æ¥</button>
      
      <!-- ç¤ºä¾‹ M3U8 é“¾æ¥ 2 -->
      <div class="video-url" id="test-url-2">
        https://bitdash-a.akamaihd.net/content/sintel/hls/playlist.m3u8
      </div>
      <button class="test-button" onclick="testM3u8Url('test-url-2')">æµ‹è¯•æ­¤é“¾æ¥</button>
      
      <!-- ç¤ºä¾‹ M3U8 é“¾æ¥ 3 -->
      <div class="video-url" id="test-url-3">
        https://sample-videos.com/zip/10/mp4/hls/SampleVideo_720x480_1mb.m3u8
      </div>
      <button class="test-button" onclick="testM3u8Url('test-url-3')">æµ‹è¯•æ­¤é“¾æ¥</button>
    </div>
    
    <div class="test-section">
      <h2>ğŸ¯ æ‰‹åŠ¨æ·»åŠ  M3U8 é“¾æ¥</h2>
      <input type="text" id="custom-url" placeholder="è¾“å…¥ M3U8 é“¾æ¥..." style="width: 70%; padding: 8px; margin-right: 10px;">
      <button class="test-button" onclick="testCustomUrl()">æµ‹è¯•è‡ªå®šä¹‰é“¾æ¥</button>
    </div>
    
    <div class="test-section">
      <h2>ğŸ“Š æµ‹è¯•çŠ¶æ€</h2>
      <div id="status" class="status"></div>
      <div id="detection-info" style="margin-top: 15px;"></div>
    </div>
    
    <div class="warning">
      <h3>âš ï¸ æ³¨æ„äº‹é¡¹</h3>
      <ul>
        <li>éƒ¨åˆ†æµ‹è¯•é“¾æ¥å¯èƒ½ç”±äºç½‘ç»œåŸå› æ— æ³•è®¿é—®</li>
        <li>æŸäº› M3U8 æµå¯èƒ½æœ‰åœ°åŸŸé™åˆ¶æˆ–éœ€è¦è®¤è¯</li>
        <li>æµ‹è¯•è¿‡ç¨‹ä¸­è¯·ä¿æŒç½‘ç»œè¿æ¥ç¨³å®š</li>
        <li>ä¸‹è½½çš„è§†é¢‘ç‰‡æ®µä¿å­˜åœ¨ Downloads/FetchVideo/temp/ ç›®å½•ä¸­</li>
      </ul>
    </div>
    
    <div class="test-section">
      <h2>ğŸ› ï¸ åˆå¹¶è§†é¢‘ç‰‡æ®µ</h2>
      <p>ä¸‹è½½å®Œæˆåï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆå¹¶è§†é¢‘ç‰‡æ®µï¼š</p>
      <div class="code">
        # ä½¿ç”¨ FFmpeg åˆå¹¶ç‰‡æ®µ<br>
        cd Downloads/FetchVideo/temp/[ä»»åŠ¡ID]/<br>
        ffmpeg -i "concat:$(ls segment_*.ts | sort -V | tr '\n' '|' | sed 's/|$//')" -c copy output.mp4
      </div>
      
      <p>æˆ–è€…ä½¿ç”¨æ–‡ä»¶åˆ—è¡¨æ–¹å¼ï¼š</p>
      <div class="code">
        ls segment_*.ts | sort -V > filelist.txt<br>
        ffmpeg -f concat -safe 0 -i filelist.txt -c copy output.mp4
      </div>
    </div>
  </div>

  <script>
    // æ¨¡æ‹Ÿæ·»åŠ  M3U8 æ•°æ®åˆ°é¡µé¢
    let currentTestUrl = '';
    
    function testM3u8Url(elementId) {
      const element = document.getElementById(elementId);
      const url = element.textContent.trim();
      currentTestUrl = url;
      
      showStatus('æ­£åœ¨æ¨¡æ‹Ÿæ·»åŠ  M3U8 æµ...', 'info');
      
      // åˆ›å»ºéšè—çš„ script æ ‡ç­¾åŒ…å« M3U8 URL
      const script = document.createElement('script');
      script.textContent = `
        // æ¨¡æ‹Ÿæµåª’ä½“é…ç½®
        window.videoStreamConfig = {
          source: "${url}",
          type: "hls",
          title: "æµ‹è¯• HLS æµ",
          quality: "720p"
        };
        
        // æ¨¡æ‹Ÿæ’­æ”¾å™¨é…ç½®
        window.playerConfig = {
          hls: "${url}",
          title: "M3U8 æµ‹è¯•è§†é¢‘"
        };
      `;
      document.head.appendChild(script);
      
      // åˆ›å»º meta æ ‡ç­¾
      const meta = document.createElement('meta');
      meta.setAttribute('property', 'video:url');
      meta.setAttribute('content', url);
      document.head.appendChild(meta);
      
      // åˆ›å»ºéšè—çš„ video å…ƒç´ 
      const video = document.createElement('video');
      video.style.display = 'none';
      video.setAttribute('data-src', url);
      video.setAttribute('data-stream-url', url);
      video.setAttribute('title', `æµ‹è¯• M3U8 è§†é¢‘ - ${Date.now()}`);
      document.body.appendChild(video);
      
      setTimeout(() => {
        showStatus('M3U8 æµå·²æ·»åŠ åˆ°é¡µé¢ï¼Œç°åœ¨å¯ä»¥ä½¿ç”¨æ‰©å±•æ£€æµ‹å’Œä¸‹è½½ã€‚', 'success');
        updateDetectionInfo(url);
      }, 1000);
    }
    
    function testCustomUrl() {
      const input = document.getElementById('custom-url');
      const url = input.value.trim();
      
      if (!url) {
        showStatus('è¯·è¾“å…¥æœ‰æ•ˆçš„ M3U8 é“¾æ¥', 'error');
        return;
      }
      
      if (!url.includes('m3u8')) {
        showStatus('é“¾æ¥ä¼¼ä¹ä¸æ˜¯ M3U8 æ ¼å¼', 'error');
        return;
      }
      
      currentTestUrl = url;
      
      // åˆ›å»ºåŒ…å«è‡ªå®šä¹‰ URL çš„å…ƒç´ 
      const div = document.createElement('div');
      div.id = 'custom-test-url';
      div.className = 'video-url';
      div.textContent = url;
      div.style.display = 'none';
      document.body.appendChild(div);
      
      testM3u8Url('custom-test-url');
    }
    
    function showStatus(message, type) {
      const status = document.getElementById('status');
      status.textContent = message;
      status.className = `status ${type}`;
      status.style.display = 'block';
    }
    
    function updateDetectionInfo(url) {
      const info = document.getElementById('detection-info');
      info.innerHTML = `
        <h4>ğŸ” æ£€æµ‹ä¿¡æ¯</h4>
        <p><strong>å½“å‰æµ‹è¯• URL:</strong></p>
        <div class="code">${url}</div>
        <p><strong>æ·»åŠ çš„é¡µé¢å…ƒç´ :</strong></p>
        <ul>
          <li>Script æ ‡ç­¾ï¼šåŒ…å« videoStreamConfig å’Œ playerConfig</li>
          <li>Meta æ ‡ç­¾ï¼šproperty="video:url"</li>
          <li>Video å…ƒç´ ï¼šdata-src å’Œ data-stream-url å±æ€§</li>
        </ul>
        <p><strong>ä¸‹ä¸€æ­¥:</strong></p>
        <ol>
          <li>ç‚¹å‡»æµè§ˆå™¨å·¥å…·æ çš„ FetchVideo æ‰©å±•å›¾æ ‡</li>
          <li>æ£€æŸ¥æ˜¯å¦æ£€æµ‹åˆ° M3U8 æµåª’ä½“</li>
          <li>ç‚¹å‡»ä¸‹è½½æŒ‰é’®å¼€å§‹ä¸‹è½½</li>
          <li>è§‚å¯Ÿä¸‹è½½è¿›åº¦å’Œé€šçŸ¥</li>
        </ol>
      `;
    }
    
    // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºåˆå§‹çŠ¶æ€
    window.addEventListener('load', () => {
      showStatus('é¡µé¢å·²å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥å¼€å§‹æµ‹è¯• M3U8 ä¸‹è½½åŠŸèƒ½ã€‚', 'info');
    });
    
    // ç›‘å¬æ‰©å±•æ¶ˆæ¯ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
    window.addEventListener('message', (event) => {
      if (event.data && event.data.type === 'fetchvideo-detection') {
        showStatus('æ‰©å±•å·²æ£€æµ‹åˆ°é¡µé¢å†…å®¹æ›´æ–°', 'success');
      }
    });
  </script>
</body>
</html>
