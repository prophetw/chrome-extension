# M3U8 自动合并下载说明

## 什么是 M3U8？

M3U8 是 HTTP Live Streaming (HLS) 的播放列表文件格式，包含了视频流的分片信息。它不是视频文件本身，而是一个指向多个视频片段（通常是 .ts 文件）的索引文件。

## 自动合并下载流程

当你点击下载 M3U8 视频时，扩展程序会执行以下步骤：

### 1. 解析阶段
- ✅ 获取 M3U8 文件内容
- ✅ 解析播放列表，提取所有视频片段链接
- ✅ 处理相对路径，转换为完整的 URL

### 2. 智能下载阶段
- ✅ 并行下载视频片段（限制并发数避免服务器压力）
- ✅ 实时显示下载进度（片段数量/总数量）
- ✅ 将片段数据保存在内存中

### 3. 自动合并阶段
- ✅ 将所有下载的片段按顺序合并
- ✅ 创建完整的视频文件
- ✅ 自动触发浏览器下载合并后的文件

### 4. 用户体验
- 🎯 **一键下载**: 点击一次即可获得完整视频
- 📊 **进度显示**: 实时显示下载和合并进度
- 💾 **自动保存**: 合并后的视频文件自动保存到下载文件夹

## 特殊标识

在视频列表中，M3U8 视频会有以下特殊标识：

- 🎬 **图标标识**：表示这是 HLS 流媒体
- **格式显示**：显示为 "🎬 HLS (自动合并)"
- **颜色标识**：左边有绿色边框
- **鼠标悬停提示**：显示 "HTTP Live Streaming - 将自动下载所有片段并合并成完整视频"

## 下载优势

### ✅ 全自动化
- 无需手动操作，一键获得完整视频
- 自动处理所有技术细节
- 智能错误恢复和重试

### ✅ 高效下载
- 并行下载多个片段提高速度
- 智能并发控制避免服务器限制
- 内存中合并，无需临时文件

### ✅ 用户友好
- 实时进度显示
- 清晰的状态反馈
- 自动文件命名和保存

## 技术特性

### 🔧 智能下载
- **并发控制**: 同时下载3个片段，平衡速度和服务器压力
- **错误处理**: 跳过失败片段，确保部分内容可用
- **进度跟踪**: 80%用于下载，20%用于合并处理

### 🗂️ 文件处理
- **内存合并**: 直接在浏览器内存中合并片段
- **自动命名**: 基于视频标题和时间戳生成文件名
- **格式保持**: 保持原始TS格式，兼容性最佳

## 故障排除

### 下载失败
- 检查网络连接
- 确认 M3U8 链接有效
- 某些网站可能有防盗链保护

### 部分片段缺失
- 扩展会自动跳过失败的片段
- 合并后的视频可能有小段空白
- 大部分内容仍然可用

### 文件格式问题
- 下载的文件是 .ts 格式
- 大部分播放器都支持 TS 格式
- 如需要其他格式，可使用视频转换工具

## 文件输出

### 📁 文件位置
合并后的视频文件保存在：
```
Downloads/FetchVideo/[视频标题]_[时间戳].ts
```

### 📄 文件命名规则
- 基于视频标题（自动清理特殊字符）
- 添加时间戳避免重名
- 保持 .ts 扩展名确保兼容性

### 🎥 播放兼容性
- TS 格式广泛支持
- 可直接在多数媒体播放器中播放
- 如需转换，可使用 FFmpeg 等工具

## 使用建议

### 💡 最佳实践
1. **网络环境**: 确保网络连接稳定
2. **存储空间**: 确保有足够的磁盘空间
3. **浏览器设置**: 允许扩展访问下载权限
4. **并发下载**: 避免同时下载多个大型 M3U8 文件

### ⚡ 性能优化
- 扩展自动优化下载并发数
- 内存中合并避免磁盘I/O
- 智能错误恢复机制
